<!DOCTYPE html>
<html>
<head>
  <link href='https://fonts.googleapis.com/css?family=Roboto:400,700' rel='stylesheet' type='text/css'>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta http-equiv="Content-Style-Type" content="text/css" />
  <meta name="generator" content="pandoc" />
  <title></title>
  <style type="text/css">code{white-space: pre;}</style>
  <style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
  </style>
<link rel="stylesheet" href="https://skiadas.github.io/css/course.css" type="text/css" />
<script type="text/javascript"
  src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>
</head>
<body>
<h1 id="object-properties">Object Properties</h1>
<p>We discuss here various issues related to Javascript object properties.</p>
<h1 id="relevant-links">Relevant Links</h1>
<ul>
<li>Flanagan’s book, 6.6-6.8</li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object">Object methods in MDN</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/defineProperty">Object.defineProperty in MDN</a></li>
</ul>
<h2 id="notes">Notes</h2>
<p>An object’s properties have a number of customizable “attributes”, that are exposed via methods of <code>Object</code>. These attributes are used when we try to set properties via <code>Object.defineProperty</code> or <code>Object,defineProperties</code> or when we pass a second argument to <code>Object.create</code>.</p>
<p>A call to <code>Object.defineProperty</code> would look something like this:</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="va">Object</span>.<span class="at">defineProperty</span>(obj<span class="op">,</span> prop<span class="op">,</span> desc)</code></pre></div>
<p>where the third argument is a “descriptor” object containing the attributes. There are two types of descriptor objects, “data” and “accessor”.</p>
<p>Both types of descriptors are allowed to contain the following two properties:</p>
<dl>
<dt>configurable</dt>
<dd>Boolean, default false. Determines if the property can be configured and deleted.
</dd>
<dt>enumerable</dt>
<dd>Boolean, default false. Whether this property will show up during enumeration (say in a for-in loop).
</dd>
</dl>
<p>Data descriptors are meant for properties that simply hold values, and will contain the following keys:</p>
<dl>
<dt>value</dt>
<dd>The initial value. Defaults to <code>undefined</code>.
</dd>
<dt>writable</dt>
<dd>Boolean, determining whether the variable is writable or not.
</dd>
</dl>
<p>Accessor descriptors are meant for properties that require getter and setter methods, and will contain the following keys:</p>
<dl>
<dt>get</dt>
<dd>A function <code>f</code> whose return value is what the property returns. A value of <code>undefined</code> would mean there is no getter.
</dd>
<dt>set</dt>
<dd>A function <code>f(v)</code> used to “set” the value of the property to the value v. A value of <code>undefined</code> will mean there is no setter.
</dd>
</dl>
<p>Here is an example of this:</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> o <span class="op">=</span> <span class="op">{};</span>
<span class="va">Object</span>.<span class="at">defineProperty</span>(o<span class="op">,</span> <span class="st">&#39;countMe&#39;</span><span class="op">,</span> <span class="op">{</span>
    <span class="dt">set</span><span class="op">:</span> <span class="kw">undefined</span><span class="op">,</span>
    <span class="dt">get</span><span class="op">:</span> (<span class="kw">function</span>() <span class="op">{</span>
        <span class="kw">var</span> count <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>
        <span class="cf">return</span> <span class="kw">function</span>() <span class="op">{</span> count <span class="op">+=</span> <span class="dv">1</span><span class="op">;</span> <span class="cf">return</span> count<span class="op">;</span> <span class="op">};</span>
    <span class="op">}</span>())
<span class="op">}</span>)</code></pre></div>
<p>Use these features sparingly!</p>
<h3 id="small-getset-illustration-temperatures">Small get/set Illustration: Temperatures</h3>
<p>Here is a small example where these getters and setters might be useful. Say we want to create a “temperature” object that understands both Celsius and Fahrenheit. Here is a way to do it:</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">function</span> <span class="at">f2c</span>(F) <span class="op">{</span> <span class="cf">return</span> (F <span class="op">-</span> <span class="dv">32</span>) <span class="op">*</span> <span class="dv">5</span> / <span class="dv">9</span><span class="op">;</span> <span class="op">}</span>
<span class="kw">function</span> <span class="at">c2f</span>(C) <span class="op">{</span> <span class="cf">return</span> C <span class="op">*</span> <span class="dv">9</span> / <span class="dv">5</span> <span class="op">+</span> <span class="dv">32</span><span class="op">;</span> <span class="op">}</span>
<span class="kw">function</span> <span class="at">makeTemp</span>() <span class="op">{</span>
    <span class="kw">var</span> o <span class="op">=</span> <span class="va">Object</span>.<span class="at">create</span>(<span class="kw">null</span>)<span class="op">;</span>
    <span class="va">o</span>.<span class="at">C</span> <span class="op">=</span> <span class="dv">0</span><span class="op">;</span>
    <span class="va">Object</span>.<span class="at">defineProperty</span>(o<span class="op">,</span> <span class="st">&quot;F&quot;</span><span class="op">,</span> <span class="op">{</span>
        <span class="dt">configurable</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span>
        <span class="dt">enumerable</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span>
        <span class="dt">get</span><span class="op">:</span> <span class="kw">function</span>() <span class="op">{</span> <span class="cf">return</span> <span class="at">c2f</span>(<span class="kw">this</span>.<span class="at">C</span>)<span class="op">;</span> <span class="op">},</span>
        <span class="dt">set</span><span class="op">:</span> <span class="kw">function</span>(F) <span class="op">{</span> <span class="kw">this</span>.<span class="at">C</span> <span class="op">=</span> <span class="at">f2c</span>(F)<span class="op">;</span> <span class="cf">return</span> F<span class="op">;</span> <span class="op">}</span>
    <span class="op">}</span>)<span class="op">;</span>
    <span class="cf">return</span> o<span class="op">;</span>
<span class="op">}</span></code></pre></div>
<p>We are essentially turning “F” into a “virtual property”, that instead just sets the corresponding C value appropriately transformed.</p>
<p>You can also use these get/set methods to do some validation.</p>
<h3 id="stack-implementation-again.-locking-things-down.">Stack implementation, again. Locking things down.</h3>
<p>Let us look at what was the second version of the prototype-based implementation of stacks we had in previous classes:</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> Stack <span class="op">=</span> <span class="op">{};</span>
<span class="va">Stack</span>.<span class="at">new</span> <span class="op">=</span> <span class="kw">function</span> <span class="at">makeStack</span>() <span class="op">{</span>
    <span class="kw">var</span> o <span class="op">=</span> <span class="va">Object</span>.<span class="at">create</span>(<span class="va">Stack</span>.<span class="at">_proto</span>)<span class="op">;</span>
    <span class="va">o</span>.<span class="at">values</span> <span class="op">=</span> []<span class="op">;</span>
    <span class="cf">return</span> o<span class="op">;</span>
<span class="op">};</span>
<span class="va">Stack</span>.<span class="at">_proto</span> <span class="op">=</span> <span class="op">{</span>
    <span class="dt">push</span><span class="op">:</span> <span class="kw">function</span> <span class="at">push</span>(el) <span class="op">{</span>
        <span class="kw">this</span>.<span class="va">values</span>.<span class="at">push</span>(el)<span class="op">;</span>
        <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span>
    <span class="op">},</span>
    <span class="dt">pop</span><span class="op">:</span> <span class="kw">function</span> <span class="at">pop</span>() <span class="op">{</span>
        <span class="cf">if</span> (<span class="kw">this</span>.<span class="at">isEmpty</span>()) <span class="op">{</span>
            <span class="cf">throw</span> <span class="kw">new</span> <span class="at">Error</span>(<span class="st">&quot;Attempt to pop from empty stack&quot;</span>)<span class="op">;</span>
        <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span>
            <span class="cf">return</span> <span class="kw">this</span>.<span class="va">values</span>.<span class="at">pop</span>()<span class="op">;</span>
        <span class="op">}</span>
    <span class="op">},</span>
    <span class="dt">isEmpty</span><span class="op">:</span> <span class="kw">function</span> <span class="at">isEmpty</span>() <span class="op">{</span>
        <span class="cf">return</span> <span class="kw">this</span>.<span class="va">values</span>.<span class="at">length</span> <span class="op">===</span> <span class="dv">0</span><span class="op">;</span>
    <span class="op">}</span>
<span class="op">};</span></code></pre></div>
<p>This was not a bad implementation, but it had some “flaws”. It allows people to change it. We will try to “lock it down”. This is not always a good idea, so think carefully before trying to do this.</p>
<p>Here are the “flaws”:</p>
<ol style="list-style-type: decimal">
<li>The <code>_proto</code> property is visible: If someone enumerates the keys in <code>Stack</code>, it will see it. We will want to make it not enumerable, so that it can be accessed only if someone wants to find it.</li>
<li>The <code>_proto</code> property is configurable and writeable. Someone can change what prototype object our stack objects will inherit.</li>
<li>The object pointed to by the <code>_proto</code> property is editable. This means someone can change how our prototype methods behave, add their own, remove them altogether, and so on.</li>
<li>The object pointed to by the <code>_proto</code> property inherits from <code>Object.prototype</code>. We do not really need it to.</li>
<li>The <code>values</code> property of individual objects, that contains the array of values in the stack, is enumerable. This should not be visible to the world.</li>
<li>The <code>values</code> property is writeable. Someone could simply replace our array with their own.</li>
<li>The stack object we return is extensible. Someone could implement “push” and “pop” methods on it, and they will hide our prototype methods.</li>
<li>The array stored in the <code>values</code> property is subject to all array methods, so someone could manually add and remove properties. Nothing we can do to protect from that, if we want to use prototypes (though we will discuss a somewhat obscure solution further down).</li>
</ol>
<p>So let us see how we can address these issues:</p>
<ol style="list-style-type: decimal">
<li>We will make sure that the <code>_proto</code> property is marked as not enumerable, not configurable, and not writeable.</li>
<li>We will <a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/freeze">freeze</a> the object that <code>_proto</code> points to. We will also create it to inherit from null.</li>
<li>We will mark the <code>values</code> property as being not enumerable, not configurable, and not writeable.</li>
<li>We will freeze the stack object we return.</li>
</ol>
<p>Here is an implementation:</p>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> Stack <span class="op">=</span> <span class="va">Object</span>.<span class="at">freeze</span>(<span class="va">Object</span>.<span class="at">create</span>(<span class="kw">null</span><span class="op">,</span> <span class="op">{</span>
    <span class="kw">new</span><span class="op">:</span> <span class="op">{</span>
        <span class="dt">enumerable</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span>
        <span class="dt">configurable</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span>
        <span class="dt">writeable</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span>
        <span class="dt">value</span><span class="op">:</span> <span class="kw">function</span> <span class="at">makeStack</span>() <span class="op">{</span>
            <span class="cf">return</span> <span class="va">Object</span>.<span class="at">freeze</span>(<span class="va">Object</span>.<span class="at">create</span>(<span class="va">Stack</span>.<span class="at">_proto</span><span class="op">,</span> <span class="op">{</span>
                <span class="dt">values</span><span class="op">:</span> <span class="op">{</span>
                    <span class="dt">enumerable</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span>
                    <span class="dt">configurable</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span>
                    <span class="dt">writeable</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span>
                    <span class="dt">value</span><span class="op">:</span> []
                <span class="op">}</span>
            <span class="op">}</span>))<span class="op">;</span>
        <span class="op">}</span>
    <span class="op">},</span>
    <span class="dt">_proto</span><span class="op">:</span> <span class="op">{</span>
        <span class="dt">enumerable</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span>
        <span class="dt">configurable</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span>
        <span class="dt">writeable</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span>
        <span class="dt">value</span><span class="op">:</span> <span class="va">Object</span>.<span class="at">freeze</span>(<span class="op">{</span>
            <span class="dt">push</span><span class="op">:</span> <span class="kw">function</span> <span class="at">push</span>(el) <span class="op">{</span>
                <span class="kw">this</span>.<span class="va">values</span>.<span class="at">push</span>(el)<span class="op">;</span>
                <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span>
            <span class="op">},</span>
            <span class="dt">pop</span><span class="op">:</span> <span class="kw">function</span> <span class="at">pop</span>() <span class="op">{</span>
                <span class="cf">if</span> (<span class="kw">this</span>.<span class="at">isEmpty</span>()) <span class="op">{</span>
                    <span class="cf">throw</span> <span class="kw">new</span> <span class="at">Error</span>(<span class="st">&quot;Attempt to pop from empty stack&quot;</span>)<span class="op">;</span>
                <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span>
                    <span class="cf">return</span> <span class="kw">this</span>.<span class="va">values</span>.<span class="at">pop</span>()<span class="op">;</span>
                <span class="op">}</span>
            <span class="op">},</span>
            <span class="dt">isEmpty</span><span class="op">:</span> <span class="kw">function</span> <span class="at">isEmpty</span>() <span class="op">{</span>
                <span class="cf">return</span> <span class="kw">this</span>.<span class="va">values</span>.<span class="at">length</span> <span class="op">===</span> <span class="dv">0</span><span class="op">;</span>
            <span class="op">}</span>
        <span class="op">}</span>)
    <span class="op">}</span>
<span class="op">}</span>))<span class="op">;</span>

<span class="va">Object</span>.<span class="at">keys</span>(Stack)<span class="op">;</span>    <span class="co">// Only [&quot;new&quot;]</span>
<span class="va">Stack</span>.<span class="va">_proto</span>.<span class="at">f</span> <span class="op">=</span> <span class="dv">2</span><span class="op">;</span>    <span class="co">// Fails to change _proto</span>
<span class="kw">var</span> s1 <span class="op">=</span> <span class="va">Stack</span>.<span class="at">new</span>()<span class="op">;</span>
<span class="va">s1</span>.<span class="at">push</span> <span class="op">=</span> <span class="dv">2</span><span class="op">;</span>           <span class="co">// Fails to create a push property</span>
<span class="va">Object</span>.<span class="at">keys</span>(s1)<span class="op">;</span>       <span class="co">// Empty</span>
<span class="va">s1</span>.<span class="at">push</span>(<span class="dv">2</span>).<span class="at">push</span>(<span class="dv">3</span>)<span class="op">;</span>    <span class="co">// These work fine.</span>
<span class="va">s1</span>.<span class="at">pop</span>()<span class="op">;</span>
<span class="va">s1</span>.<span class="at">values</span><span class="op">;</span>             <span class="co">// Shows us what&#39;s there</span>
<span class="va">s1</span>.<span class="at">values</span> <span class="op">=</span> []<span class="op">;</span>        <span class="co">// Fails to change the values array.</span>
<span class="va">s1</span>.<span class="va">values</span>.<span class="at">push</span>(<span class="dv">4</span>)<span class="op">;</span>     <span class="co">// But this works and modifies the array.</span></code></pre></div>
<h3 id="optional-further-lockdown">Optional: Further lockdown</h3>
<p>We will describe here a way to lock down even that part of the story, where the values array is accessible to users of our stack. Here is the plan:</p>
<ul>
<li>Create a local variable keeping an array called <code>cache</code>, whose elements are the arrays for our stacks. This variable will be visible to the prototype methods, but not to the outside world. We wrap the whole thing in a immediate function invocation to create this local scope.</li>
<li>When a new stack object is created, an index is stored in the object and a place for it is created in <code>cache</code>, to hold its array of elements. The index stored in the object creates a link between the cache and the object.</li>
<li>Our stack methods will need to first look the array up based on the index in their <code>this</code> object, then perform the appropriate operation on it.</li>
</ul>
<div class="sourceCode"><pre class="sourceCode javascript"><code class="sourceCode javascript"><span class="kw">var</span> Stack <span class="op">=</span> (<span class="kw">function</span>() <span class="op">{</span>
    <span class="kw">var</span> cache<span class="op">,</span> proto<span class="op">;</span>

    cache <span class="op">=</span> []<span class="op">;</span>

    <span class="kw">function</span> <span class="at">makeStack</span>() <span class="op">{</span>
        <span class="va">cache</span>.<span class="at">push</span>([])<span class="op">;</span>
        <span class="cf">return</span> <span class="va">Object</span>.<span class="at">freeze</span>(<span class="va">Object</span>.<span class="at">create</span>(proto<span class="op">,</span> <span class="op">{</span>
            <span class="dt">index</span><span class="op">:</span> <span class="op">{</span>
                <span class="dt">enumerable</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span>
                <span class="dt">configurable</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span>
                <span class="dt">writeable</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span>
                <span class="dt">value</span><span class="op">:</span> <span class="va">cache</span>.<span class="at">length</span> <span class="op">-</span> <span class="dv">1</span>
            <span class="op">}</span>
        <span class="op">}</span>))<span class="op">;</span>
    <span class="op">}</span>

    proto <span class="op">=</span> <span class="va">Object</span>.<span class="at">freeze</span>(<span class="op">{</span>
        <span class="dt">push</span><span class="op">:</span> <span class="kw">function</span> <span class="at">push</span>(el) <span class="op">{</span>
            cache[<span class="kw">this</span>.<span class="at">index</span>].<span class="at">push</span>(el)<span class="op">;</span>
            <span class="cf">return</span> <span class="kw">this</span><span class="op">;</span>
        <span class="op">},</span>
        <span class="dt">pop</span><span class="op">:</span> <span class="kw">function</span> <span class="at">pop</span>() <span class="op">{</span>
            <span class="cf">if</span> (<span class="kw">this</span>.<span class="at">isEmpty</span>()) <span class="op">{</span>
                <span class="cf">throw</span> <span class="kw">new</span> <span class="at">Error</span>(<span class="st">&quot;Attempt to pop from empty stack&quot;</span>)<span class="op">;</span>
            <span class="op">}</span> <span class="cf">else</span> <span class="op">{</span>
                <span class="cf">return</span> cache[<span class="kw">this</span>.<span class="at">index</span>].<span class="at">pop</span>()<span class="op">;</span>
            <span class="op">}</span>
        <span class="op">},</span>
        <span class="dt">isEmpty</span><span class="op">:</span> <span class="kw">function</span> <span class="at">isEmpty</span>() <span class="op">{</span>
            <span class="cf">return</span> cache[<span class="kw">this</span>.<span class="at">index</span>].<span class="at">length</span> <span class="op">===</span> <span class="dv">0</span><span class="op">;</span>
        <span class="op">}</span>
    <span class="op">}</span>)<span class="op">;</span>

    <span class="cf">return</span> <span class="va">Object</span>.<span class="at">freeze</span>(<span class="va">Object</span>.<span class="at">create</span>(<span class="kw">null</span><span class="op">,</span> <span class="op">{</span>
        <span class="st">&quot;new&quot;</span><span class="op">:</span> <span class="op">{</span>
            <span class="dt">enumerable</span><span class="op">:</span> <span class="kw">true</span><span class="op">,</span>
            <span class="dt">configurable</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span>
            <span class="dt">writeable</span><span class="op">:</span> <span class="kw">false</span><span class="op">,</span>
            <span class="dt">value</span><span class="op">:</span> makeStack
        <span class="op">}</span>
    <span class="op">}</span>))<span class="op">;</span>
<span class="op">}</span>())<span class="op">;</span></code></pre></div>
<p>One downside to this pattern, other than its complexity, is that automatic garbage collection cannot clear the cache array for us: If a stack object is garbage-collected, we have no real way of knowing it. We would have to add a manual method for people to call when they no longer need the stack, so we can do some cleanup.</p>
</body>
</html>
